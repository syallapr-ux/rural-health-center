<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Secure Login | Rural Health Connect</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>

<body class="bg-light">

<!-- ================= NAVBAR ================= -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
    <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">
            <i class="fa-solid fa-shield-heart me-2"></i>Rural Health Connect
        </a>
    </div>
</nav>

<!-- ================= HEADER ================= -->
<header class="bg-secondary text-white py-5">
    <div class="container">
        <h1 class="fw-bold">Secure User Authentication</h1>
        <p class="mb-0">
            Role-based access for healthcare staff (Simulation)
        </p>
    </div>
</header>

<!-- ================= MAIN ================= -->
<main class="container my-5">

    <!-- INFO -->
    <div class="alert alert-info">
        <strong>Technical Note:</strong>  
        This login system simulates authentication using encrypted browser storage.
        In production, this would be replaced with OAuth2 / JWT / ABDM-compliant APIs.
    </div>

    <div class="row g-4">

        <!-- LOGIN FORM -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h3 class="fw-bold mb-3">
                        <i class="fa-solid fa-right-to-bracket me-2"></i>
                        User Login
                    </h3>

                    <form id="loginForm">
                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" id="loginUsername" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" id="loginPassword" class="form-control" required>
                        </div>

                        <button class="btn btn-success w-100 fw-bold" type="submit">
                            <i class="fa-solid fa-lock-open me-2"></i>
                            Login Securely
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- REGISTER FORM -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h3 class="fw-bold mb-3">
                        <i class="fa-solid fa-user-plus me-2"></i>
                        Register Staff
                    </h3>

                    <form id="registerForm">
                        <div class="mb-2">
                            <label class="form-label">Username</label>
                            <input type="text" id="regUsername" class="form-control" required>
                        </div>

                        <div class="mb-2">
                            <label class="form-label">Password</label>
                            <input type="password" id="regPassword" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Role</label>
                            <select id="regRole" class="form-select" required>
                                <option value="">Select Role</option>
                                <option value="Admin">Administrator</option>
                                <option value="Doctor">Doctor</option>
                                <option value="Staff">Hospital Staff</option>
                            </select>
                        </div>

                        <button class="btn btn-primary w-100 fw-bold" type="submit">
                            <i class="fa-solid fa-user-check me-2"></i>
                            Register User
                        </button>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <!-- SESSION STATUS -->
    <div class="card mt-5 shadow-sm border-0">
        <div class="card-body">
            <h4 class="fw-bold">
                <i class="fa-solid fa-user-shield me-2"></i>
                Active Session
            </h4>
            <p id="sessionStatus" class="text-muted mb-0">
                No active session
            </p>
        </div>
    </div>

</main>

<!-- ================= FOOTER ================= -->
<footer class="bg-dark text-light py-4 mt-5">
    <div class="container text-center small">
        Secure Authentication Module | Rural Health Connect
    </div>
</footer>

<!-- ================= SCRIPT ================= -->
<script>
function hashPassword(pwd) {
    return btoa(pwd); // simulated encryption (base64)
}

function getUsers() {
    return JSON.parse(localStorage.getItem("users")) || [];
}

function setUsers(users) {
    localStorage.setItem("users", JSON.stringify(users));
}

document.getElementById("registerForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const users = getUsers();
    const username = regUsername.value;

    if (users.find(u => u.username === username)) {
        alert("User already exists!");
        return;
    }

    users.push({
        username,
        password: hashPassword(regPassword.value),
        role: regRole.value
    });

    setUsers(users);
    this.reset();
    alert("User registered successfully!");
});

document.getElementById("loginForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const users = getUsers();
    const user = users.find(u =>
        u.username === loginUsername.value &&
        u.password === hashPassword(loginPassword.value)
    );

    if (!user) {
        alert("Invalid credentials!");
        return;
    }

    localStorage.setItem("session", JSON.stringify({
        username: user.username,
        role: user.role,
        loginTime: new Date().toISOString()
    }));

    updateSession();
    alert("Login successful!");
});

function updateSession() {
    const session = JSON.parse(localStorage.getItem("session"));
    if (session) {
        sessionStatus.innerHTML = `
            Logged in as <strong>${session.username}</strong>
            (<span class="text-primary">${session.role}</span>)
        `;
    }
}

updateSession();
</script>

</body>
</html>
