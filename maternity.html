<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Maternity & Maternal Health | Rural Health Connect</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
    .error { border: 2px solid #dc3545; }
    .high-risk-row { background-color: #fff3cd; }
    .referred-row { background-color: #f8d7da; }
</style>
</head>

<body class="bg-light">

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-primary shadow">
<div class="container">
<span class="navbar-brand fw-bold">
<i class="fa-solid fa-person-pregnant me-2"></i>
Maternal & Child Health Portal
</span>
</div>
</nav>

<!-- HEADER -->
<header class="bg-dark text-white py-4">
<div class="container">
<h3 class="fw-bold">Maternity & Maternal Health Services</h3>
<p class="mb-0">ANC | High-Risk Monitoring | Institutional Deliveries</p>
</div>
</header>

<main class="container my-5">

<!-- DASHBOARD -->
<section class="mb-5">
<h4 class="fw-bold mb-3">Facility Dashboard</h4>
<div class="row g-3 text-center">
<div class="col-md-3"><div class="card p-3"><h6>Active Pregnancies</h6><h4 id="activeCount">0</h4></div></div>
<div class="col-md-3"><div class="card p-3"><h6>High-Risk Cases</h6><h4 class="text-danger" id="riskCount">0</h4></div></div>
<div class="col-md-3"><div class="card p-3"><h6>Institutional Deliveries</h6><h4 id="deliveryCount">0</h4></div></div>
<div class="col-md-3"><div class="card p-3"><h6>JSY Beneficiaries</h6><h4 id="jsyCount">0</h4></div></div>
</div>
</section>

<!-- ANC FORM -->
<section class="mb-5">
<div class="card shadow">
<div class="card-body">
<h4 class="fw-bold mb-3">ANC Registration</h4>

<div class="row g-3">
<input class="form-control" placeholder="Mother Name" id="mother">
<input class="form-control" placeholder="ABHA / Aadhaar (10–14 digits)" id="abha">
<input class="form-control" type="number" placeholder="Gestational Age (weeks)" id="weeks">
<select class="form-select" id="risk">
<option value="">Risk Category</option>
<option>Normal</option>
<option>Moderate Risk</option>
<option>High Risk</option>
</select>
</div>

<button class="btn btn-primary mt-3" onclick="registerANC()">Register ANC</button>

<div id="msgBox" class="alert d-none mt-3"></div>

<div class="alert alert-info mt-3 small">
Data stored locally to simulate RCH / HMIS backend.
</div>
</div>
</div>
</section>

<!-- HIGH RISK TABLE -->
<section>
<h4 class="fw-bold mb-3 text-danger">High-Risk Pregnancy Monitoring</h4>
<table class="table table-bordered bg-white">
<thead class="table-light">
<tr>
<th>ANC ID</th>
<th>Name</th>
<th>Weeks</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>
<tbody id="riskTable"></tbody>
</table>
</section>

</main>

<footer class="bg-dark text-light text-center py-3 small">
Maternal Health Module – Simulation of NHM Systems
</footer>

<script>
/* ---------------- STORAGE SERVICE (Backend-ready) ---------------- */
const StorageService = {
    get() {
        return JSON.parse(localStorage.getItem("ancData")) || [];
    },
    save(data) {
        localStorage.setItem("ancData", JSON.stringify(data));
    }
};

let data = StorageService.get();

/* ---------------- UI MESSAGE HANDLER ---------------- */
function showMessage(type, text) {
    const box = document.getElementById("msgBox");
    box.className = `alert alert-${type}`;
    box.innerText = text;
    box.classList.remove("d-none");
}

/* ---------------- DASHBOARD ---------------- */
function updateDashboard() {
    document.getElementById("activeCount").innerText = data.length;
    document.getElementById("riskCount").innerText = data.filter(d => d.risk === "High Risk").length;

    document.getElementById("deliveryCount").innerText =
        data.filter(d => d.weeks >= 37).length;

    document.getElementById("jsyCount").innerText =
        data.filter(d => d.weeks >= 37).length;
}

/* ---------------- HIGH RISK TABLE ---------------- */
function renderTable() {
    const table = document.getElementById("riskTable");
    table.innerHTML = "";

    data.filter(d => d.risk === "High Risk").forEach(d => {
        table.innerHTML += `
        <tr class="${d.status === 'Referred' ? 'referred-row' : 'high-risk-row'}">
            <td>${d.id}</td>
            <td>${d.name}</td>
            <td>${d.weeks}</td>
            <td>${d.status}</td>
            <td>
                ${d.status !== "Referred" ? 
                `<button class="btn btn-sm btn-danger" onclick="referCase('${d.id}')">Refer</button>` 
                : "-"}
            </td>
        </tr>`;
    });
}

/* ---------------- REFER CASE ---------------- */
function referCase(id) {
    data = data.map(d =>
        d.id === id ? { ...d, status: "Referred" } : d
    );
    StorageService.save(data);
    renderTable();
    showMessage("warning", "Case referred to higher facility");
}

/* ---------------- ANC REGISTRATION ---------------- */
function registerANC() {
    const m = document.getElementById("mother").value.trim();
    const a = document.getElementById("abha").value.trim();
    const w = Number(document.getElementById("weeks").value);
    const r = document.getElementById("risk").value;

    document.querySelectorAll(".form-control, .form-select").forEach(f => f.classList.remove("error"));
    document.getElementById("msgBox").classList.add("d-none");

    if (!m || !a || !w || !r) {
        showMessage("danger", "All fields are required");
        return;
    }

    if (!/^\d{10,14}$/.test(a)) {
        showMessage("danger", "Enter a valid ABHA/Aadhaar number");
        document.getElementById("abha").classList.add("error");
        return;
    }

    if (w < 1 || w > 42) {
        showMessage("danger", "Gestational age must be between 1 and 42 weeks");
        document.getElementById("weeks").classList.add("error");
        return;
    }

    data.push({
        id: "ANC-" + Date.now(),
        name: m,
        abha: a,
        weeks: w,
        risk: r,
        status: r === "High Risk" ? "Under Monitoring" : "Normal",
        registeredOn: new Date().toISOString()
    });

    StorageService.save(data);
    updateDashboard();
    renderTable();

    showMessage("success", "ANC registered successfully");

    document.querySelectorAll("input,select").forEach(i => i.value = "");
}

/* ---------------- INITIAL LOAD ---------------- */
updateDashboard();
renderTable();
</script>

</body>
</html>
